# MicroPython固件烧写指南

## 概述
本指南详细介绍如何将MicroPython固件烧写到ESP8266开发板上。

## 准备工作

### 1. 硬件准备
- ESP8266开发板 (NodeMCU、Wemos D1 Mini等)
- USB数据线 (确保数据线支持数据传输)
- 电脑 (Windows/macOS/Linux)

### 2. 软件准备
- Python 3.6+ (用于安装esptool)
- esptool工具
- MicroPython固件文件

## 方法一：使用esptool命令行工具 (推荐)

### 1. 安装esptool
```bash
# 使用pip安装
pip install esptool

# 验证安装
esptool.py --version
```

### 2. 下载MicroPython固件
- 访问官方下载页面: https://micropython.org/download/esp8266/
- 选择最新的稳定版本
- 下载`.bin`文件 (例如: `esp8266-20230426-v1.20.0.bin`)

### 3. 连接ESP8266
- 将ESP8266通过USB线连接到电脑
- 确认设备被识别 (查看设备管理器或`ls /dev/tty*`)

### 4. 查找串口
```bash
# Windows (设备管理器中查看)
# 通常显示为 "COM3", "COM4" 等

# macOS/Linux
ls /dev/tty.usbserial*  # macOS
ls /dev/ttyUSB*         # Linux
```

### 5. 擦除Flash
```bash
# Windows
esptool.py --port COM3 erase_flash

# macOS/Linux
esptool.py --port /dev/ttyUSB0 erase_flash
```

### 6. 烧写固件
```bash
# Windows
esptool.py --port COM3 --baud 460800 write_flash --flash_size=detect 0x00000 esp8266-firmware.bin

# macOS/Linux
esptool.py --port /dev/ttyUSB0 --baud 460800 write_flash --flash_size=detect 0x00000 esp8266-firmware.bin
```

## 方法二：使用Thonny IDE (图形界面)

### 1. 安装Thonny IDE
- 下载地址: https://thonny.org/
- 支持Windows、macOS、Linux

### 2. 连接ESP8266
- 打开Thonny IDE
- 工具 -> 选项 -> 解释器
- 选择"MicroPython (ESP8266)"
- 选择正确的端口

### 3. 烧写固件
- 工具 -> 管理包
- 选择"MicroPython (ESP8266)"
- 点击"安装"

## 方法三：使用NodeMCU-PyFlasher (Windows专用)

### 1. 下载NodeMCU-PyFlasher
- 下载地址: https://github.com/marcelstoer/nodemcu-pyflasher/releases
- 选择适合的版本下载

### 2. 运行程序
- 解压并运行exe文件
- 选择串口
- 选择固件文件
- 点击"Flash NodeMCU"

## 常见问题解决

### 1. 串口无法识别
**问题**: 设备管理器中没有显示串口设备
**解决方案**:
- 检查USB线是否支持数据传输
- 安装CH340/CP210x驱动
- 尝试不同的USB端口

### 2. 烧写失败
**问题**: 烧写过程中出现错误
**解决方案**:
- 降低波特率: `--baud 115200`
- 按住FLASH按钮再按复位按钮
- 检查固件文件是否损坏

### 3. 固件启动失败
**问题**: 烧写成功但设备无法启动
**解决方案**:
- 检查Flash大小设置
- 重新擦除Flash
- 尝试不同的固件版本

## 验证烧写成功

### 1. 串口连接测试
```bash
# 使用screen连接 (macOS/Linux)
screen /dev/ttyUSB0 115200

# 使用PuTTY连接 (Windows)
# 选择串口，波特率115200
```

### 2. 测试MicroPython
连接后应该看到:
```
MicroPython v1.20.0 on 2023-04-26; ESP module with ESP8266
Type "help()" for more information.
>>>
```

### 3. 基本命令测试
```python
# 测试基本功能
print("Hello, MicroPython!")

# 测试GPIO
import machine
led = machine.Pin(2, machine.Pin.OUT)
led.value(0)  # 点亮LED
```

## 高级配置

### 1. 自定义分区表
```bash
# 创建自定义分区表
esptool.py --port COM3 write_flash 0x8000 partitions.csv
```

### 2. 烧写多个文件
```bash
# 烧写固件和文件系统
esptool.py --port COM3 write_flash \
  --flash_size=detect \
  0x00000 firmware.bin \
  0x100000 filesystem.bin
```

### 3. 备份当前固件
```bash
# 备份整个Flash
esptool.py --port COM3 read_flash 0x00000 0x100000 backup.bin
```

## 固件版本选择

### 1. 稳定版本
- 推荐使用最新的稳定版本
- 功能完整，bug较少

### 2. 开发版本
- 包含最新功能
- 可能存在不稳定问题

### 3. 自定义版本
- 根据需求编译
- 包含特定模块

## 注意事项

1. **备份重要数据**: 烧写前备份重要文件
2. **选择正确固件**: 确保固件版本与硬件兼容
3. **稳定电源**: 烧写过程中保持电源稳定
4. **正确连接**: 确保USB线连接正确
5. **耐心等待**: 烧写过程需要时间，不要中断

## 故障排除

### 常见错误信息
- `Failed to connect to ESP8266`: 检查连接和驱动
- `Flash size not detected`: 手动指定Flash大小
- `Invalid head of packet`: 降低波特率重试

### 联系支持
- MicroPython官方论坛
- ESP8266社区
- GitHub Issues 