# NodeMCU 固件烧录脚本使用说明

## 📁 文件说明

- `flash_firmware.sh` - macOS/Linux 烧录脚本
- `flash_firmware.bat` - Windows 烧录脚本
- `*.bin` - NodeMCU 固件文件

## 🚀 快速使用

### Windows 用户

1. 双击运行 `flash_firmware.bat`
2. 按照提示选择串口和固件文件
3. 确认后自动完成烧录

### macOS/Linux 用户

```bash
# 进入固件烧录目录
cd tools/固件烧录

# 运行烧录脚本
./flash_firmware.sh
```

## ✨ 脚本功能特性

### 🔍 自动检测
- **串口检测**: 自动扫描可用的串口设备
- **固件检测**: 自动发现目录中的 .bin 固件文件
- **依赖检查**: 验证 esptool 是否已安装

### 🛡️ 安全保护
- **连接验证**: 烧录前验证设备连接状态
- **错误处理**: 完善的错误提示和处理机制
- **用户确认**: 烧录前需要用户确认操作

### ⚡ 智能烧录
- **双速尝试**: 优先使用高速烧录，失败时自动降速
- **自动擦除**: 烧录前自动擦除旧固件
- **结果验证**: 烧录完成后验证操作结果

## 📋 使用步骤

### 1. 准备工作
```bash
# 确保已安装 esptool
pip install esptool

# 确保固件文件在当前目录
ls *.bin
```

### 2. 连接设备
- 使用 USB 数据线连接 NodeMCU 到电脑
- 确保串口驱动已正确安装

### 3. 运行脚本
- Windows: 双击 `flash_firmware.bat`
- macOS/Linux: 运行 `./flash_firmware.sh`

### 4. 按提示操作
1. 选择检测到的串口
2. 选择要烧录的固件文件
3. 确认烧录信息
4. 等待烧录完成

## 🔧 故障排除

### 串口检测失败
```
[ERROR] 未检测到串口设备
```
**解决方案:**
- 检查 USB 连接
- 重新安装串口驱动
- 尝试不同的 USB 端口

### 设备连接失败
```
[ERROR] 无法连接到设备
```
**解决方案:**
- 确认串口选择正确
- 关闭占用串口的其他程序 (如 ESPlorer)
- 按住 NodeMCU 上的 FLASH 按钮重试

### 烧录失败
```
[ERROR] 固件烧录失败
```
**解决方案:**
- 检查固件文件是否完整
- 尝试更换 USB 线
- 烧录时按住 FLASH 按钮

## 📊 支持的设备

### 串口芯片
- **CH340/CH341** (最常见)
- **CP2102/CP2104**
- **FTDI** 系列

### 操作系统
- **Windows** 7/8/10/11
- **macOS** 10.12+
- **Linux** (Ubuntu, CentOS, etc.)

## 🎯 烧录后验证

烧录完成后，可以通过以下方式验证：

### 使用 ESPlorer
1. 打开 ESPlorer
2. 选择对应串口，波特率 115200
3. 点击连接
4. 按下 NodeMCU 的 RST 按钮
5. 应该看到启动信息

### 使用串口工具
```bash
# 连接串口 (macOS/Linux)
screen /dev/ttyUSB0 115200

# 按 RST 按钮，应该看到类似输出:
# NodeMCU 0.9.6 build 20150704 powered by Lua 5.1.4
```

### 测试 Lua 命令
在连接的终端中输入：
```lua
print("Hello NodeMCU!")
-- 应该输出: Hello NodeMCU!

print(node.info())
-- 显示固件信息
```

## 💡 使用技巧

### 批量烧录
如果需要烧录多个设备：
1. 准备多个相同的固件文件
2. 逐个连接设备运行脚本
3. 建议使用 USB Hub 提高效率

### 固件选择建议
- **Float 版本**: 支持浮点运算，适合传感器项目
- **Integer 版本**: 更节省内存，适合简单控制项目
- **自定义模块**: 根据项目需求选择必要模块

### 常用波特率
- **烧录**: 460800 (高速) / 115200 (兼容)
- **调试**: 115200 (标准)
- **生产**: 9600 (稳定)

---

**注意**: 烧录过程中请勿断开连接，整个过程通常需要 2-5 分钟。
